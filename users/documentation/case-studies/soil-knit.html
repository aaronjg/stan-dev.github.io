<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Bob Carpenter" />

<meta name="date" content="2014-11-24" />

<title>Soil Carbon Modeling with RStan</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="site_libs/highlight/default.css"
      type="text/css" />
<script src="site_libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Soil Carbon Modeling with RStan</h1>
<h4 class="author"><em>Bob Carpenter</em></h4>
<h4 class="date"><em>24 November 2014</em></h4>

</div>


<div id="overview" class="section level3">
<h3>Overview</h3>
<div id="experimental-data" class="section level4">
<h4>Experimental Data</h4>
<p>
Soil incubation experiments are used to estimate parameters of physical models of carbon flow in soil under different conditions. In the laboratory, external conditions such as temperature and moisture can be controlled, as can inputs such as leaf litter or microbial content and diversity. Measurements of carbon emissions are taken over time, perhaps along with other information such as microbial enzyme activity.<br />

<div style="width:3in; float:right; padding: 1em">
<p><img src="img/jena-Weckglas.jpg" alt="Incubation experiment" /> <em>Soil incubation experiment in progress at the Max Planck Institute, Jena.</em></p>
</div>
</div>
<div id="physical-models" class="section level4">
<h4>Physical Models</h4>
<p>
<p>Most soil-carbon physical models approximate soil heterogeneity with discrete pools of carbon. For example, a two-compartment model posits a labile pool of carbon with readily available carbon and a recalcitrant pool from which carbonr evolves more slowly. Systems may also posit additional pools for microbes, enzymes, and other physical features of soil ecology. Some of these pools may be measured. System dynamics are modeled with differential equations describing flows among the compartments.</p>
</div>
<div id="statistical-models-and-inference" class="section level4">
<h4>Statistical Models and Inference</h4>
<p>
<p>Statistical models are overlayed on the deterministic physical models to represent measurement error and unmodeled variation among replicated experiments. Bayesian statistical inference can be applied to estimate parameters based on combining experimental measurements with prior scientific knowledge of soil carbon dynamics or the experimental mechanism. Poststratification may then be used to predict behavior on regional or global scales based on information about biogeochemical conditions, which are typically estimated for geographical grids on the 10–100 kilometer square scale.</p>
<div style="width:3in; float:right; padding: 1em">
<p><img src="img/euro_carbon_s.png" alt="Incubation experiment" /> <em>Pan-European soil organic carbon (SOC) stock of agricultural soils. Image from European Commission, Joint Research Centre, European Soil Portal.</em></p>
</div>
<p>
<p>Stan provides an expressive modeling language for statistical models including a full linear algebra and statistical library along with ordinary differential equation solvers. Stan also provides an efficient and scalable, fully Bayesian, inference mechanism based on adaptive Hamiltonian Monte Carlo sampling. Stan is integrated into the R statistical programming environment through the RStan interface.</p>
</div>
<div id="this-document" class="section level4">
<h4>This Document</h4>
<p>The rest of this document describes</p>
<ul>
<li>data from a soil incubation study of evolved CO<sub>2</sub>,</li>
<li>a differential equation model of the process with two compartments and feedback,</li>
<li>an <a href="http://mc-stan.org/">RStan</a> implementation of the model, and</li>
<li>summaries of Bayesian parameter estimates (a.k.a., data integration, inverse analysis).</li>
</ul>
<p> </p>
</div>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>Sierra and Müller (2014) performed a soil incubation experiment in which they took a series of 25 measurements over time of evolved CO<sub>2</sub>. At each time point, multiple readings were taken from replicates and aggregated into a mean and standard deviation.</p>
<p>The data can be read in through Sierra and Müller’s (2014) <a href="http://cran.r-project.org/web/packages/SoilR/index.html">SoilR</a> package.</p>
<div id="load-data" class="section level4">
<h4>Load Data</h4>
<pre class="r"><code>library(SoilR,quietly=TRUE);</code></pre>
<pre><code>## 
## Attaching package: &#39;deSolve&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:graphics&#39;:
## 
##     matplot</code></pre>
</div>
<div id="munge-data" class="section level4">
<h4>Munge Data</h4>
<pre class="r"><code>totalC_t0 &lt;- 7.7;         # not included in data, so hard code here
t0 &lt;- 0;
N_t &lt;- 25;                # calculated by inspection
ts &lt;- eCO2[1:25,2];
eCO2mean &lt;- eCO2[1:25,3];   
eCO2sd &lt;- eCO2[1:25,4];   </code></pre>
</div>
<div id="plot-data" class="section level4">
<h4>Plot Data</h4>
<pre class="r"><code>library(ggplot2,quietly=TRUE);
df &lt;- data.frame(list(ts=ts,eCO2mean=eCO2mean,eCO2sd=eCO2sd));
interval_95pct &lt;- aes(ymin = eCO2mean + 1.96 * eCO2sd, 
                      ymax = eCO2mean - 1.96 * eCO2sd);
plot_data &lt;- 
  ggplot(df, aes(x=ts, y=eCO2mean)) +
  geom_point() + 
  geom_errorbar(interval_95pct, width=0, colour=&quot;blue&quot;) +
  scale_x_continuous(name=&quot;time (days)&quot;) +
  scale_y_continuous(name=&quot;evolved CO2 (mgC g-1 soil)&quot;) +
  ggtitle(&quot;Evolved CO2 Measurements (with 95% intervals)&quot;);
plot(plot_data);</code></pre>
<div class="figure">
<img src="soil-knit_files/figure-html/unnamed-chunk-3-1.png" alt="<i>Caption Goes here and how will it look?</i>&quot; width=“672” /&gt;
<p class="caption">
<i>Caption Goes here and how will it look?</i>
</p>
</div>
</div>
<div id="physical-model" class="section level3">
<h3>Physical Model</h3>
<div id="two-pool-linear-model-with-feedback" class="section level4">
<h4>Two Pool Linear Model with Feedback</h4>
<p>Sierra and Müller (2014) present a two-pool model with decomposition rates for each pool as well as transfer rates from one pool to another.</p>
<p>Let <span class="math inline">\(C(t) = (C_1(t), C_2(t))\)</span> be the concentration of carbon in pools 1 and 2. The model assumes pool-specific decomposition rates <span class="math inline">\(\kappa_1, \kappa_2\)</span> and transfer rates <span class="math inline">\(\alpha_{2,1}\)</span> and <span class="math inline">\(\alpha_{1,2}\)</span> from pool 2 to pool 1 and vice-versa. The system dynamics are modeled through the equations <span class="math display">\[
\frac{d C_1(t)}{dt} = - \kappa_1 \, C_1(t) + \alpha_{2,1} \, \kappa_2 \, C_2(t)
\]</span> and <span class="math display">\[
\frac{d C_2(t)}{dt} = - \kappa_2 \, C_2(t) + \alpha_{1,2} \, \kappa_1 \, C_1(t).
\]</span></p>
<p>Given initial carbon concentrations <span class="math inline">\(C(0)\)</span> at <span class="math inline">\(t = 0\)</span> and values for parameters <span class="math inline">\(\kappa, \alpha\)</span>, these equations may be solved for <span class="math inline">\(C(t_n)\)</span> at measurement times <span class="math inline">\(t_n &gt; 0\)</span>.</p>
</div>
</div>
<div id="statistical-model" class="section level3">
<h3>Statistical Model</h3>
<div id="measurements" class="section level4">
<h4>Measurements</h4>
<div id="initial-state-measurement" class="section level5">
<h5>Initial State Measurement</h5>
<p>Because the two pools are theoretical constructs to account for soil heterogeneity, they are not measured directly. Instead, only the total initial carbon <span class="math inline">\(C_1(0) + C_2(0)\)</span> is measured, not how it is partitioned between the two pools.</p>
</div>
<div id="evolved-carbon-measurement" class="section level5">
<h5>Evolved Carbon Measurement</h5>
<p>For each measurement time <span class="math inline">\(t_n\)</span>, the total carbon evolved from the system since the initial time <span class="math inline">\(t = 0\)</span> is measured and recorded as <span class="math inline">\(\mbox{eCO}_2(t_n)\)</span>. This measurement is of the quantity predicted by the system of differential equations to be the total initial carbon minus what is left in the pools at time <span class="math inline">\(t_n\)</span>, <span class="math display">\[
\left[ C_1(0) + C_2(0) \right] - \left[ C_1(t_n) + C_2(t_n) \right].
\]</span> The SoilR package provides the <span class="math inline">\(\mbox{eCO2}_2(t_n)\)</span> measurements.</p>
</div>
</div>
<div id="statistical-model-parameters" class="section level4">
<h4>Statistical Model Parameters</h4>
<p>The statistical model assumes the following parameters.</p>
<table>
<thead>
<tr class="header">
<th align="left">Param</th>
<th align="left">Range</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\gamma\)</span></td>
<td align="left"><span class="math inline">\((0,1)\)</span></td>
<td align="left">proportion of initial carbon in pool 1</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\kappa_1\)</span></td>
<td align="left"><span class="math inline">\((0,\infty)\)</span></td>
<td align="left">decomposition rate (pool 1)</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\kappa_2\)</span></td>
<td align="left"><span class="math inline">\((0,\infty)\)</span></td>
<td align="left">decomposition rate (pool 2)</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\alpha_{2,1}\)</span></td>
<td align="left"><span class="math inline">\((0,\infty)\)</span></td>
<td align="left">transfer rate (pool 2 to 1)</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\alpha_{1,2}\)</span></td>
<td align="left"><span class="math inline">\((0,\infty)\)</span></td>
<td align="left">transfer rate (pool 1 to 2)</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\sigma\)</span></td>
<td align="left"><span class="math inline">\((0,\infty)\)</span></td>
<td align="left">residual error scale</td>
</tr>
</tbody>
</table>
</div>
<div id="probability-model" class="section level4">
<h4>Probability Model</h4>
<div id="priors" class="section level5">
<h5>Priors</h5>
<p>Weakly informative priors are supplied for all parameters, whose rough values are known from previous experiments.</p>
<p><span class="math display">\[\gamma \sim \mbox{Beta}(10,1)\]</span></p>
<p><span class="math display">\[\kappa_1, \kappa_2, \alpha_{1,2}, \alpha_{2,1} \sim \mbox{Normal}(0,1)\]</span></p>
<p><span class="math display">\[\sigma \sim \mbox{Cauchy}(0,1)\]</span></p>
</div>
<div id="sampling-distribution" class="section level5">
<h5>Sampling Distribution</h5>
<p>The sampling distribution is a standard predictive error model assuming normal error of predictions,</p>
<p><span class="math display">\[\mbox{eCO}_2(t) \sim \mbox{Normal}(\hat{\mbox{eCO}_2}(t), \sigma),\]</span></p>
<p>where <span class="math inline">\(\mbox{eCO}_2(t)\)</span> is the measured evolved carbon and <span class="math inline">\(\hat{\mbox{eCO}_2}(t)\)</span> is the estimate of evolved carbon based on the solutions <span class="math inline">\(C(t)\)</span> to the system equations given initial condition <span class="math inline">\(C(0)\)</span> and model parameters <span class="math inline">\((\gamma,\kappa,\alpha,\sigma)\)</span>.</p>
<p>With this model, the noise scale <span class="math inline">\(\sigma\)</span> is accounting both for measurement error in <span class="math inline">\(\mbox{eCO}_2(t)\)</span> and the misprediction of the model with estimated parameters.</p>
</div>
<div id="posterior-distribution" class="section level5">
<h5>Posterior Distribution</h5>
<p>By Bayes’s rule, the posterior distribution of the parameters given the observations is <span class="math display">\[
p(\gamma,\kappa,\alpha,\sigma \, | \, \mbox{eCO}_2,C(0))
\ \propto \ p(\mbox{eCO}_2 \, | \, \gamma,\kappa,\alpha,\sigma,C(0)) \ p(\gamma,\kappa,\alpha,\sigma).
\]</span> Here, <span class="math inline">\(\mbox{eCO}_2\)</span> is the full sequence of evolved carbon measurements.</p>
</div>
</div>
<div id="stan-program" class="section level4">
<h4>Stan Program</h4>
<p>The following is a dump of a file containing the Stan program to implement the 2-pool model with feedback as described above; the model code is fully documented, and is explained at more length below.</p>
<pre class="r"><code>file_path &lt;- &quot;soil_incubation.stan&quot;;
lines &lt;- readLines(file_path, encoding=&quot;ASCII&quot;);
for (n in 1:length(lines)) cat(lines[n],&#39;\n&#39;);</code></pre>
<pre><code>functions { 
 
  /** 
   * ODE system for two pool model with feedback and no inputs. 
   * 
   * This is the version that does not deal with measurement error. 
   * 
   * System State C is two dimensional with C[1] and C[2]  
   * being carbon in pools 1 and 2. 
   * 
   * The system has parameters 
   * 
   *   theta = (k1, k2, alpha21, alpha12) 
   * 
   * where 
   * 
   *   k1:       pool 1 decomposition rate 
   *   k2:       pool 2 decomposition rate 
   *   alpha21:  transfer coefficient from pool 2 to pool 1 
   *   alpha12:  transfer coefficient from pool 1 to pool 2 
   * 
   * The system time derivatives are 
   * 
   *   d.C[1] / d.t  =  -k1 * C[1]  +  alpha12 * k2 * C[2] 
   * 
   *   d.C[2] / d.t  =  alpha21 * k1 * C[1]  -  k2 * C[2] 
   * 
   * @param t time at which derivatives are evaluated. 
   * @param C system state at which derivatives are evaluated. 
   * @param theta parameters for system. 
   * @param x_r real constants for system (empty). 
   * @param x_i integer constants for system (empty). 
   */ 
  real[] two_pool_feedback(real t, real[] C, real[] theta, 
                           real[] x_r, int[] x_i) { 
    real k1; 
    real k2; 
    real alpha21; 
    real alpha12; 
 
    real dC_dt[2]; 
 
    k1 &lt;- theta[1]; 
    k2 &lt;- theta[2]; 
    alpha21 &lt;- theta[3]; 
    alpha12 &lt;- theta[4]; 
     
    dC_dt[1] &lt;- -k1 * C[1] + alpha12 * k2 * C[2]; 
    dC_dt[2] &lt;- - k2 * C[2] + alpha21 * k1 * C[1] ; 
 
    return dC_dt; 
  } 
 
  /** 
   * Compute total evolved CO2 from the system given the specified 
   * parameters and times.  This is done by simulating the system 
   * defined by the ODE function two_pool_feedback and then 
   * subtracting the sum of the CO2 estimated in each pool from the 
   * initial CO2. 
   * 
   * @param T number of times. 
   * @param t0 initial time. 
   * @param ts observation times. 
   * @param gamma partitioning coefficient. 
   * @param k1 decomposition rate for pool 1 
   * @param k2 decomposition rate for pool 2 
   * @param alpha21 transfer coefficient from pool 2 to 1 
   * @param alpha12 transfer coefficient from pool 1 to 2 
   * @param x_r real data (empty) 
   * @param x_i integer data (empty) 
   * @return evolved CO2 for times ts 
   */ 
  real[] evolved_CO2(int N_t, real t0, real[] ts, 
                     real gamma, real totalC_t0, 
                     real k1, real k2,  
                     real alpha21, real alpha12, 
                     real[] x_r, int[] x_i) { 
 
    real C_t0[2];               // initial state 
    real theta[4];              // ODE parameters 
    real C_hat[N_t,2];          // predicted pool content 
 
    real eCO2_hat[N_t]; 
 
    C_t0[1] &lt;- gamma * totalC_t0; 
    C_t0[2] &lt;- (1 - gamma) * totalC_t0; 
 
    theta[1] &lt;- k1; 
    theta[2] &lt;- k2; 
    theta[3] &lt;- alpha21; 
    theta[4] &lt;- alpha12; 
 
    C_hat &lt;- integrate_ode(two_pool_feedback,  
                           C_t0, t0, ts, theta, x_r, x_i); 
 
    for (t in 1:N_t) 
      eCO2_hat[t] &lt;- totalC_t0 - sum(C_hat[t]); 
    return eCO2_hat; 
  } 
 
} 
data { 
  real&lt;lower=0&gt; totalC_t0;     // initial total carbon 
 
  real t0;                     // initial time 
  int&lt;lower=0&gt; N_t;            // number of measurement times 
  real&lt;lower=t0&gt; ts[N_t];      // measurement times 
 
 
  real&lt;lower=0&gt; eCO2mean[N_t]; // measured cumulative evolved carbon 
} 
transformed data { 
  real x_r[0];                 // no real data for ODE system 
  int x_i[0];                  // no integer data for ODE system 
} 
parameters { 
  real&lt;lower=0&gt; k1;            // pool 1 decomposition rate 
  real&lt;lower=0&gt; k2;            // pool 2 decomposition rate 
 
  real&lt;lower=0&gt; alpha21;       // transfer coeff from pool 2 to 1 
  real&lt;lower=0&gt; alpha12;       // transfer coeff from pool 1 to 2 
 
  real&lt;lower=0,upper=1&gt; gamma; // partitioning coefficient 
 
  real&lt;lower=0&gt; sigma;         // observation std dev 
} 
transformed parameters { 
  real eCO2_hat[N_t]; 
  eCO2_hat &lt;- evolved_CO2(N_t, t0, ts, gamma, totalC_t0, 
                          k1, k2, alpha21, alpha12, x_r, x_i); 
} 
model { 
  // priors 
  gamma ~ beta(10,1);         // identifies pools 
  k1 ~ normal(0,1);           // weakly informative 
  k2 ~ normal(0,1); 
  alpha21 ~ normal(0,1); 
  alpha12 ~ normal(0,1); 
  sigma ~ cauchy(0,1); 
 
  // likelihood 
  for (t in 1:N_t) 
    eCO2mean[t] ~ normal(eCO2_hat[t], sigma);   // normal error 
} </code></pre>
<p>The Stan program begins by defining two convenience functions in the functions block.</p>
<ul>
<li><p><code>two_pool_feedback()</code> computes the solutions to the system of differential equations given the model parameters, initial conditions, and requested solution times in an array. The second.</p></li>
<li><p><code>evolved_CO2()</code> computes the cumulative evolved CO<sub>2</sub> given the compartment concentrations computed by the first function.</p></li>
</ul>
<p>The data block declares the data that is read in, including the initial total carbon, initial time, measurement times, and measured total evolved carbon. The parameter block declares parameters with constraints as defined above. The transformed parameter block is used to compute the evolved CO<sub>2</sub> estimate given the system equations and parameter values. Finally, the model block just repeats the sampling distributions for all of the parameters.</p>
</div>
<div id="fitting-the-model-with-rstan" class="section level4">
<h4>Fitting the Model with RStan</h4>
<pre class="r"><code>library(rstan);
fit &lt;- stan(&quot;soil_incubation.stan&quot;,
            data=c(&quot;totalC_t0&quot;, &quot;t0&quot;, &quot;N_t&quot;, &quot;ts&quot;, &quot;eCO2mean&quot;),
            control=list(adapt_delta=0.90,
                         stepsize=0.005),
            chains=2, iter=200, seed=1234);</code></pre>
<pre><code>## In file included from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/BH/include/boost/config.hpp:39:0,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/BH/include/boost/math/tools/config.hpp:13,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/core/var.hpp:7,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/core/gevv_vvv_vari.hpp:5,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/core.hpp:12,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/mat.hpp:4,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math.hpp:4,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/src/stan/model/model_header.hpp:4,
##                  from file161734d02dab.cpp:8:
## /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/BH/include/boost/config/compiler/gcc.hpp:186:0: warning: &quot;BOOST_NO_CXX11_RVALUE_REFERENCES&quot; redefined
##  #  define BOOST_NO_CXX11_RVALUE_REFERENCES
##  ^
## &lt;command-line&gt;:0:0: note: this is the location of the previous definition</code></pre>
<pre><code>## Warning: There were 11 divergent transitions after warmup. Increasing adapt_delta above 0.9 may help. See
## http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
<pre><code>## Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
</div>
</div>
<div id="fit-summary" class="section level3">
<h3>Fit Summary</h3>
<p>The following R code will print the summary of a model fit; explanations below.</p>
<pre class="r"><code>options(width=&quot;100&quot;);
print(fit,digits=2);</code></pre>
<pre><code>## Inference for Stan model: soil_incubation.
## 2 chains, each with iter=200; warmup=100; thin=1; 
## post-warmup draws per chain=100, total post-warmup draws=200.
## 
##              mean se_mean   sd  2.5%  25%  50%  75% 97.5% n_eff Rhat
## k1           0.19    0.02 0.11  0.07 0.10 0.15 0.22  0.51    54 1.04
## k2           0.88    0.16 0.60  0.14 0.38 0.80 1.19  2.40    14 1.09
## alpha21      0.65    0.42 0.45  0.04 0.20 0.64 1.04  1.63     1 2.30
## alpha12      1.00    0.61 0.66  0.09 0.44 0.74 1.50  2.30     1 2.21
## gamma        0.88    0.08 0.10  0.67 0.81 0.89 0.96  0.99     2 1.46
## sigma        0.37    0.00 0.06  0.27 0.32 0.36 0.40  0.49   195 0.99
## eCO2_hat[1]  0.24    0.02 0.16 -0.12 0.13 0.26 0.35  0.52    89 1.01
## eCO2_hat[2]  0.59    0.02 0.17  0.27 0.47 0.60 0.71  0.90    89 1.00
## eCO2_hat[3]  1.83    0.02 0.15  1.58 1.72 1.84 1.94  2.13    74 1.02
## eCO2_hat[4]  2.25    0.02 0.14  2.01 2.15 2.25 2.35  2.53    78 1.02
## eCO2_hat[5]  2.63    0.01 0.13  2.39 2.53 2.63 2.73  2.89    92 1.02
## eCO2_hat[6]  2.97    0.01 0.13  2.73 2.88 2.96 3.06  3.21   105 1.01
## eCO2_hat[7]  3.30    0.01 0.12  3.09 3.21 3.29 3.38  3.53   127 1.01
## eCO2_hat[8]  4.15    0.01 0.11  3.95 4.07 4.15 4.21  4.36   200 0.99
## eCO2_hat[9]  4.40    0.01 0.10  4.20 4.34 4.40 4.47  4.62   200 0.99
## eCO2_hat[10] 4.62    0.01 0.10  4.41 4.56 4.62 4.68  4.82   200 0.99
## eCO2_hat[11] 4.83    0.01 0.10  4.62 4.77 4.83 4.89  5.03   200 0.99
## eCO2_hat[12] 5.03    0.01 0.10  4.82 4.97 5.03 5.09  5.22   200 0.99
## eCO2_hat[13] 5.56    0.01 0.10  5.34 5.49 5.56 5.62  5.72   200 1.00
## eCO2_hat[14] 5.70    0.01 0.10  5.48 5.63 5.71 5.77  5.86   200 1.01
## eCO2_hat[15] 5.84    0.01 0.10  5.62 5.77 5.85 5.90  6.00   200 1.01
## eCO2_hat[16] 5.97    0.01 0.10  5.75 5.91 5.98 6.04  6.13   200 1.01
## eCO2_hat[17] 6.09    0.01 0.10  5.87 6.02 6.09 6.15  6.24   200 1.01
## eCO2_hat[18] 6.41    0.01 0.09  6.20 6.35 6.42 6.47  6.57   126 1.02
## eCO2_hat[19] 6.50    0.01 0.09  6.30 6.44 6.51 6.56  6.67   121 1.02
## eCO2_hat[20] 6.58    0.01 0.09  6.38 6.51 6.59 6.64  6.74   117 1.02
## eCO2_hat[21] 6.66    0.01 0.09  6.46 6.60 6.67 6.71  6.82   114 1.02
## eCO2_hat[22] 6.73    0.01 0.09  6.54 6.67 6.74 6.79  6.88   111 1.03
## eCO2_hat[23] 7.23    0.01 0.06  7.10 7.19 7.24 7.27  7.34    94 1.03
## eCO2_hat[24] 7.26    0.01 0.06  7.13 7.22 7.27 7.30  7.37    93 1.03
## eCO2_hat[25] 7.29    0.01 0.06  7.17 7.26 7.30 7.33  7.39    92 1.03
## lp__         3.56    0.64 2.27 -1.77 2.76 3.89 4.97  6.61    13 1.11
## 
## Samples were drawn using NUTS(diag_e) at Tue Jun 27 21:22:56 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>There is one row per parameter, with the following columns, with statistics computed over all draws making up the sample.</p>
<p>In addition to the parameters, the row <code>lp__</code> indicates the log density evaluated by the model; note that this quantity is equal to the log posterior up to an additive constant.</p>
<table>
<thead>
<tr class="header">
<th align="left">Column</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>mean</code></td>
<td align="left">mean</td>
</tr>
<tr class="even">
<td align="left"><code>sd</code></td>
<td align="left">standard deviation</td>
</tr>
<tr class="odd">
<td align="left"><code>N%</code></td>
<td align="left">percentiles (N/100 quantile)</td>
</tr>
<tr class="even">
<td align="left"><code>50%</code></td>
<td align="left">median</td>
</tr>
<tr class="odd">
<td align="left"><code>n_eff</code></td>
<td align="left">number of effective samples</td>
</tr>
<tr class="even">
<td align="left"><code>R_hat</code></td>
<td align="left">potential scale reduction statistic (<span class="math inline">\(\hat{R}\)</span>)</td>
</tr>
<tr class="odd">
<td align="left"><code>se_mean</code></td>
<td align="left">standard error of posterior mean estimate (<code>sd / sqrt(n_eff)</code>)</td>
</tr>
</tbody>
</table>
<p>Inspecting the output, the Stan implementation provided comparable posterior estimates to those estimated with SoilR by Sierra and Müller (2014). This is a nice sanity check on both implementations.</p>
<div id="traceplots" class="section level4">
<h4>Traceplots</h4>
<pre class="r"><code>traceplot(fit,c(&quot;k1&quot;,&quot;k2&quot;,&quot;alpha21&quot;,&quot;alpha12&quot;,&quot;gamma&quot;,&quot;sigma&quot;));</code></pre>
<p><img src="soil-knit_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The warmup draws are highlighted with grey background; rather than sampling, Stan is adapting the sampling parameters (discretization interval and mass matrix). The traceplots during the sampling stage indicate Stan is mixing well.</p>
<p>If Stan does not mix well, try lowering the initial step size, increasing the target acceptance rate, and increasing the number of warmup iterations.</p>
</div>
<div id="posterior-histograms-and-scatterplots-pairs" class="section level4">
<h4>Posterior Histograms and Scatterplots (pairs)</h4>
<p>The <code>pairs()</code> function in RStan displays a grid of plots. The diagonal contains a histogram of the posterior samples for each parameter; the above and below diagonals provide scatterplots for pairs of parameters. The above and below plots are based on draws from the two different Markov chains.</p>
<pre class="r"><code>pairs(fit, pars=c(&quot;k1&quot;,&quot;k2&quot;,&quot;alpha21&quot;,&quot;alpha12&quot;,&quot;gamma&quot;,&quot;sigma&quot;));</code></pre>
<p><img src="soil-knit_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="model-fit" class="section level4">
<h4>Model Fit</h4>
<p>The following figure, based on a figure in Sierra and Müller (2014), overlays the earlier plot of data and measurement error (blue) with the posterior median prediction for evolved CO<sub>2</sub> (red) with 95% intervals (yellow) calculated from the median of the residual noise (<span class="math inline">\(\sigma\)</span>) in the posterior.</p>
<pre class="r"><code>library(ggplot2);
fit_ss &lt;- extract(fit);
sigma_hat &lt;- median(fit_ss$sigma);
eCO2_hat &lt;- rep(NA,N_t);
for (t in 1:N_t) {
  eCO2_hat[t] &lt;- median(fit_ss$eCO2_hat[,t]);
}
df_post &lt;- data.frame(list(ts = ts, 
                           eCO2meas = eCO2mean,
                           eCO2_hat = eCO2_hat));

library(ggplot2);
      
interval_95pct &lt;- aes(ymin = eCO2mean + 1.96 * eCO2sd, 
                      ymax = eCO2mean - 1.96 * eCO2sd);

ggplot(df_post, aes(x = ts)) +
  geom_ribbon(aes(ymin = eCO2_hat - 1.96 * sigma_hat,
                  ymax = eCO2_hat + 1.96 * sigma_hat),
                  fill=&quot;lightyellow&quot;) +
  geom_line(aes(y=eCO2_hat),colour=&quot;darkred&quot;) +
  geom_point(aes(y=eCO2meas),colour=&quot;darkblue&quot;) +
  geom_errorbar(interval_95pct, width=0, colour=&quot;blue&quot;) +
  labs(x=&quot;time (days)&quot;, 
       y=&quot;evolved CO2 (mgC g-1 soil)&quot;) +
  ggtitle(&quot;Soil Incubation: 2 pools, feedback\nposterior median (red), predictive 95% (yellow)&quot;);</code></pre>
<p><img src="soil-knit_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
</div>
<div id="measurement-error-model" class="section level3">
<h3>Measurement Error Model</h3>
<p>It is straightforward to add a measurement error component to the model.</p>
<pre class="r"><code>file_path &lt;- &quot;soil_incubation_measurement_err.stan&quot;;
lines &lt;- readLines(file_path, encoding=&quot;ASCII&quot;);
for (n in 1:length(lines)) cat(lines[n],&#39;\n&#39;);</code></pre>
<pre><code>functions { 
 
  real[] two_pool_feedback(real t, real[] C, real[] theta, 
                           real[] x_r, int[] x_i) { 
    real k1; 
    real k2; 
    real alpha21; 
    real alpha12; 
 
    real dC_dt[2]; 
 
    k1 &lt;- theta[1]; 
    k2 &lt;- theta[2]; 
    alpha21 &lt;- theta[3]; 
    alpha12 &lt;- theta[4]; 
     
    dC_dt[1] &lt;- -k1 * C[1] + alpha12 * k2 * C[2]; 
    dC_dt[2] &lt;- alpha21 * k1 * C[1] - k2 * C[2]; 
 
    return dC_dt; 
  } 
 
  real[] evolved_CO2(int N_t, real t0, real[] ts, 
                     real gamma, real totalC_t0, 
                     real k1, real k2,  
                     real alpha21, real alpha12, 
                     real[] x_r, int[] x_i) { 
 
    real C_t0[2];               // initial state 
    real theta[4];              // ODE parameters 
    real C_hat[N_t,2];          // predicted pool content 
 
    real eCO2_hat[N_t]; 
 
    C_t0[1] &lt;- gamma * totalC_t0; 
    C_t0[2] &lt;- (1 - gamma) * totalC_t0; 
 
    theta[1] &lt;- k1; 
    theta[2] &lt;- k2; 
    theta[3] &lt;- alpha21; 
    theta[4] &lt;- alpha12; 
 
    C_hat &lt;- integrate_ode(two_pool_feedback,  
                           C_t0, t0, ts, theta, x_r, x_i); 
 
    for (t in 1:N_t) 
      eCO2_hat[t] &lt;- totalC_t0 - sum(C_hat[t]); 
    return eCO2_hat; 
  } 
 
} 
data { 
  real&lt;lower=0&gt; totalC_t0;     // initial total carbon 
 
  real t0;                     // initial time 
  int&lt;lower=0&gt; N_t;            // number of measurement times 
  real&lt;lower=t0&gt; ts[N_t];      // measurement times 
 
  vector&lt;lower=0&gt;[N_t] eCO2mean; // measured cumulative evolved carbon 
  real&lt;lower=0&gt; eCO2sd[N_t];   // measured cumulative evolved carbon 
} 
transformed data { 
  real x_r[0];                 // no real data for ODE system 
  int x_i[0];                  // no integer data for ODE system 
} 
parameters { 
  real&lt;lower=0&gt; k1;            // pool 1 decomposition rate 
  real&lt;lower=0&gt; k2;            // pool 2 decomposition rate 
 
  real&lt;lower=0&gt; alpha21;       // transfer coeff from pool 2 to 1 
  real&lt;lower=0&gt; alpha12;       // transfer coeff from pool 1 to 2 
 
  real&lt;lower=0,upper=1&gt; gamma; // partitioning coefficient 
 
  real&lt;lower=0&gt; sigma;         // observation std dev 
 
  vector&lt;lower=0&gt;[N_t] eCO2;   // evolved CO2 
} 
transformed parameters { 
  real eCO2_hat[N_t]; 
  eCO2_hat &lt;- evolved_CO2(N_t, t0, ts, gamma, totalC_t0, 
                          k1, k2, alpha21, alpha12, x_r, x_i); 
} 
model { 
  gamma ~ beta(10,1);         // identifies pools 
  k1 ~ normal(0,1);           // weakly informative 
  k2 ~ normal(0,1); 
  alpha21 ~ normal(0,1); 
  alpha12 ~ normal(0,1); 
  sigma ~ normal(0,1); 
 
  // likelihood marginalizes out eCO2 
 
  // true eCO2 (unknown) generated from system plus noise 
  eCO2 ~ normal(eCO2_hat, sigma);  
 
  // measurement eCO2mean (observed) of true eCO2 value with 
  // measurement noise eCO2sd (observed) 
  eCO2mean ~ normal(eCO2, eCO2sd);  
 
} </code></pre>
<p>This can be fit as before; note the additional data variable, <code>eCO2sd</code>.</p>
<pre class="r"><code>fit_me &lt;- stan(&quot;soil_incubation_measurement_err.stan&quot;,
              data=c(&quot;totalC_t0&quot;, &quot;t0&quot;, &quot;N_t&quot;, &quot;ts&quot;, &quot;eCO2mean&quot;, &quot;eCO2sd&quot;),
              control=list(adapt_delta=0.90,
                           stepsize=0.005),
              chains=2, iter=100, seed=1234);</code></pre>
<pre><code>## In file included from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/BH/include/boost/config.hpp:39:0,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/BH/include/boost/math/tools/config.hpp:13,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/core/var.hpp:7,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/core/gevv_vvv_vari.hpp:5,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/core.hpp:12,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math/rev/mat.hpp:4,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/stan/math.hpp:4,
##                  from /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/StanHeaders/include/src/stan/model/model_header.hpp:4,
##                  from file16174a31a166.cpp:8:
## /home/aaronjg/R/x86_64-pc-linux-gnu-library/3.3/BH/include/boost/config/compiler/gcc.hpp:186:0: warning: &quot;BOOST_NO_CXX11_RVALUE_REFERENCES&quot; redefined
##  #  define BOOST_NO_CXX11_RVALUE_REFERENCES
##  ^
## &lt;command-line&gt;:0:0: note: this is the location of the previous definition</code></pre>
<pre><code>## Warning: There were 21 transitions after warmup that exceeded the maximum treedepth. Increase max_treedepth above 10. See
## http://mc-stan.org/misc/warnings.html#maximum-treedepth-exceeded</code></pre>
<pre><code>## Warning: There were 2 chains where the estimated Bayesian Fraction of Missing Information was low. See
## http://mc-stan.org/misc/warnings.html#bfmi-low</code></pre>
<pre><code>## Warning: Examine the pairs() plot to diagnose sampling problems</code></pre>
<p>Here is the summary of the posterior samples from the measurement error model.</p>
<pre class="r"><code>options(width=&quot;100&quot;);
print(fit_me,digits=2);</code></pre>
<pre><code>## Inference for Stan model: soil_incubation_measurement_err.
## 2 chains, each with iter=100; warmup=50; thin=1; 
## post-warmup draws per chain=50, total post-warmup draws=100.
## 
##                   mean  se_mean       sd      2.5%       25%      50%    75% 97.5% n_eff  Rhat
## k1                1.40     1.01     1.63      0.40      0.41     0.41   1.88  6.34     3  1.91
## k2                2.42     1.23     1.25      0.73      1.23     2.70   3.64  3.67     1  9.31
## alpha21           1.67     0.60     1.16      1.03      1.08     1.09   1.24  4.52     4  2.07
## alpha12           0.68     0.25     0.31      0.11      0.58     0.85   0.91  0.92     2  6.56
## gamma             0.42     0.29     0.30      0.13      0.13     0.33   0.71  0.86     1  9.68
## sigma             2.58     0.81     1.26      0.27      2.00     3.32   3.34  4.09     2  2.84
## eCO2[1]           0.13     0.04     0.06      0.02      0.07     0.17   0.17  0.22     2  2.01
## eCO2[2]           0.50     0.23     0.24      0.27      0.27     0.44   0.73  0.85     1  5.53
## eCO2[3]           1.49     0.85     0.95      0.67      0.68     1.05   2.28  3.68     1  2.69
## eCO2[4]           1.44     0.29     0.36      0.98      1.17     1.17   1.76  2.12     2  1.92
## eCO2[5]           3.04     0.64     0.81      0.52      2.76     3.21   3.62  3.70     2  1.82
## eCO2[6]           3.66     0.99     1.01      2.55      2.67     3.51   4.55  4.98     1 12.59
## eCO2[7]           1.25     1.13     1.44      0.17      0.17     0.17   3.16  3.42     2  2.30
## eCO2[8]           2.23     1.65     1.66      0.58      0.58     2.14   3.89  3.99     1 36.52
## eCO2[9]           2.86     1.58     1.61      1.29      1.30     2.45   4.42  5.64     1  4.81
## eCO2[10]          2.61     2.22     2.24      0.38      0.38     2.54   4.82  4.93     1 56.98
## eCO2[11]          2.21     2.12     2.23      0.14      0.14     0.85   4.69  5.20     1  3.44
## eCO2[12]          2.55     2.24     2.32      0.35      0.35     1.20   5.06  5.66     1  3.87
## eCO2[13]          3.89     0.82     1.66      0.52      3.05     3.12   5.72  6.18     4  1.46
## eCO2[14]          2.52     1.52     2.15      0.99      1.03     1.03   5.49  6.08     2  2.64
## eCO2[15]          2.05     1.67     2.48      0.39      0.39     0.40   5.66  6.14     2  2.86
## eCO2[16]          4.02     1.82     1.97      1.17      2.24     5.55   5.81  5.85     1  4.71
## eCO2[17]          3.48     1.18     1.84      0.74      2.31     2.33   5.70  6.09     2  1.80
## eCO2[18]          3.14     2.73     2.80      0.43      0.44     1.92   6.16  6.76     1  4.92
## eCO2[19]          3.57     2.58     2.70      1.05      1.06     1.63   6.55  7.08     1  3.37
## eCO2[20]          4.14     2.29     2.32      1.86      1.86     3.32   6.56  6.96     1  7.23
## eCO2[21]          2.94     2.82     2.95      0.16      0.17     1.33   6.29  6.78     1  3.99
## eCO2[22]          5.11     1.70     1.71      3.38      3.42     5.00   6.81  6.95     1 23.50
## eCO2[23]          5.04     1.69     2.61      0.45      3.41     3.47   7.90  8.49     2  1.50
## eCO2[24]          5.93     1.44     1.68      3.20      4.58     4.65   7.69  8.01     1  1.86
## eCO2[25]          4.38     3.25     3.26      1.07      1.15     4.39   7.64  7.72     1 77.91
## eCO2_hat[1]      -0.21     0.78     1.99     -5.60      0.00     0.48   0.57  2.24     6  1.24
## eCO2_hat[2]       0.78     0.39     1.31     -1.46      0.45     0.56   0.63  4.66    11  1.02
## eCO2_hat[3]       2.38     1.87     2.37      0.39      0.65     1.10   4.58  7.32     2  4.00
## eCO2_hat[4]       2.65     2.10     2.57      0.38      0.68     1.35   5.55  7.52     1  4.95
## eCO2_hat[5]       2.85     2.27     2.69      0.36      0.72     1.58   5.99  7.62     1  5.60
## eCO2_hat[6]       3.00     2.39     2.77      0.35      0.75     1.79   6.40  7.66     1  6.03
## eCO2_hat[7]       3.12     2.49     2.82      0.34      0.78     1.99   6.69  7.68     1  6.36
## eCO2_hat[8]       3.41     2.68     2.91      0.29      0.87     2.45   7.22  7.70     1  7.15
## eCO2_hat[9]       3.49     2.73     2.93      0.28      0.91     2.59   7.33  7.70     1  7.42
## eCO2_hat[10]      3.55     2.77     2.94      0.27      0.93     2.71   7.40  7.70     1  7.66
## eCO2_hat[11]      3.61     2.81     2.96      0.25      0.96     2.83   7.47  7.70     1  7.92
## eCO2_hat[12]      3.67     2.84     2.97      0.24      0.99     2.95   7.52  7.70     1  8.17
## eCO2_hat[13]      3.83     2.92     3.02      0.20      1.07     3.28   7.61  7.70     1  8.85
## eCO2_hat[14]      3.87     2.94     3.03      0.18      1.09     3.37   7.63  7.70     1  9.01
## eCO2_hat[15]      3.91     2.96     3.04      0.17      1.12     3.46   7.64  7.70     1  9.13
## eCO2_hat[16]      3.96     2.98     3.05      0.16      1.15     3.55   7.66  7.70     1  9.22
## eCO2_hat[17]      3.99     2.99     3.06      0.14      1.17     3.63   7.66  7.70     1  9.27
## eCO2_hat[18]      4.10     3.03     3.09      0.10      1.26     3.87   7.68  7.70     1  9.20
## eCO2_hat[19]      4.13     3.04     3.10      0.08      1.29     3.94   7.69  7.70     1  9.11
## eCO2_hat[20]      4.15     3.05     3.11      0.07      1.31     4.00   7.69  7.70     1  9.02
## eCO2_hat[21]      4.18     3.05     3.11      0.06      1.34     4.07   7.69  7.70     1  8.89
## eCO2_hat[22]      4.21     3.06     3.12      0.04      1.37     4.13   7.69  7.70     1  8.74
## eCO2_hat[23]      4.42     3.08     3.15     -0.10      1.64     4.64   7.70  7.70     1  7.05
## eCO2_hat[24]      4.44     3.08     3.15     -0.12      1.66     4.68   7.70  7.70     1  6.89
## eCO2_hat[25]      4.45     3.08     3.15     -0.13      1.69     4.72   7.70  7.70     1  6.73
## lp__         -16265.91 15956.92 17213.31 -42642.71 -30243.41 -7742.64 -26.46 34.37     1  6.94
## 
## Samples were drawn using NUTS(diag_e) at Tue Jun 27 21:23:58 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>And the traceplots.</p>
<pre class="r"><code>traceplot(fit_me, c(&quot;k1&quot;,&quot;k2&quot;,&quot;alpha21&quot;,&quot;alpha12&quot;,&quot;gamma&quot;,&quot;sigma&quot;));</code></pre>
<p><img src="soil-knit_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
<div id="next-steps" class="section level3">
<h3>Next Steps</h3>
<p>There are several next steps which may depend on each other.</p>
<div id="two-pool-model" class="section level5">
<h5>Two-Pool Model</h5>
<ol style="list-style-type: decimal">
<li><p>Move noise to log scale to respect positivity constraint. This will make it multiplicative instead of additive; verify this with exploratory data analysis comparing residual to value.</p></li>
<li>Evaluate some reparameterizations
<ul>
<li>independent <span class="math inline">\(a_{2,1} = \alpha_{2,1} \, \kappa_2\)</span> and <span class="math inline">\(a_{1,2} = \alpha_{1,2} \, \kappa_1\)</span>, and</li>
<li>total decay <span class="math inline">\(\kappa_1\)</span> for pool 1 and then split that with a parameter in <span class="math inline">\((0,1)\)</span> between evolution and pool 2</li>
</ul></li>
<li><p>Implement a measurement error model for each aggregated observation. This will presuppose an underlying true carbon concentration which is measured with error on several samples to produce the reported mean and standard deviations.</p></li>
<li><p>Work directly with the individual measurements in a hierarchical model.</p></li>
</ol>
</div>
<div id="michaelis-menten-forward-and-backward" class="section level5">
<h5>Michaelis-Menten, Forward and Backward</h5>
<p>These are models that involve an enzyme pool and biomass data and data from two carbon pools (or maybe just the aggregate).</p>
<ol start="5" style="list-style-type: decimal">
<li><p>Get the data into usable format.</p></li>
<li><p>Write out math for forward and reverse models.</p></li>
<li><p>Write out statistical models.</p></li>
<li><p>Implement forward Michaelis-Menten kinetics.</p></li>
<li><p>Implement reverse Michaelis-Menten kinetics.</p></li>
</ol>
</div>
<div id="mixture-models" class="section level5">
<h5>Mixture Models</h5>
<ol start="10" style="list-style-type: decimal">
<li><p>Evaluate mixture model at each observation level, which will require running the integrator to solve the diff eqs just between observation times. Each new integration will have to take up where the last solver left off.</p></li>
<li><p>Evaluate change point model going from forward to reverse kinetics. This will require evaluating the integrator over intial and final intervals of time points.</p></li>
</ol>
</div>
<div id="replication-and-tutorial" class="section level5">
<h5>Replication and Tutorial</h5>
<ol start="12" style="list-style-type: decimal">
<li>Implement the second example of radiocarbon from Sierra and Müller (2014).</li>
</ol>
</div>
</div>
<div id="references" class="section level3">
<h3>References</h3>
<div id="papers" class="section level4">
<h4>Papers</h4>
<ul>
<li><p>Schädel, C., Y. Luo, R. David Evans, S. Fei, and S. Schaeffer. 2013. Separating soil CO<sub>2</sub> efflux into C-pool-specific decay rates via inverse analysis of soil incubation data. <em>Oecologia</em> <strong>171</strong>:721–732.</p></li>
<li><p>Sierra, Carlos A. and Markus Müller. 2014. Parameter estimation of compartment models in <tt>SoilR</tt> using classical and Bayesian methods. <em>CRAN Vignette</em>. <a href="http://cran.r-project.org/web/packages/SoilR/vignettes/ParameterEstimation.pdf" >[pdf]</a></p></li>
</ul>
</div>
<div id="r-packages" class="section level4">
<h4>R Packages</h4>
<ul>
<li><p>Statistics: <a href="http://mc-stan.org/rstan.html">RStan</a></p></li>
<li><p>Plots: <a href="http://ggplot2.org">ggplot2</a></p></li>
<li><p>Data: <a href="http://cran.r-project.org/web/packages/SoilR/index.html">SoilR</a></p></li>
<li><p>Presentation: <a href="http://yihui.name/knitr/">knitr</a></p></li>
</ul>
<p> </p>
</div>
<div id="colophon" class="section level4">
<h4>Colophon</h4>
<p>All output, including plots, was generated directly from the code with the <a href="http://yihui.name/knitr/">knitr</a> R package using style Cerulean from within the <a href="http://www.rstudio.com">RStudio</a> integrated development environment.</p>
<hr />
<p><small style="color:grey"><em>This document is distributed under the <a href="http://creativecommons.org/licenses/by/3.0/">CC-BY-3 license</a>. The code is distrbuted under the <a href="http://opensource.org/licenses/BSD-3-Clause">new BSD license</a>.</em></small></p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
